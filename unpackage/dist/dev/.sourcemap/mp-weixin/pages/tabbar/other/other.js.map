{"version":3,"file":"other.js","sources":["pages/tabbar/other/other.vue","../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdGFiYmFyL290aGVyL290aGVyLnZ1ZQ"],"sourcesContent":["<template>\r\n  <!-- 联系我们按钮 -->\r\n  <view class=\"contact-trigger\" @click.stop=\"showContact = true\">\r\n    <text>联系我们</text>\r\n  </view>\r\n  <view v-if=\"showContact\" class=\"contact-popup\" @click.stop>\r\n    <view class=\"popup-content\">\r\n      <text user-select>📮联系我们：3504605396@qq.com</text>\r\n      <text user-select>👥小报订阅QQ群：{{ qqgroup }}</text>\r\n      <view class=\"popup-close\" @click=\"showContact = false\">关闭</view>\r\n    </view>\r\n  </view>\r\n\r\n  \n  <view class=\"container\" @click=\"hideSearchOverlay\">\n    <!-- 日期选择 -->\n    <view class=\"date-picker-box\">\n      <view class=\"date-label\">日期选择：</view>\n      <uni-datetime-picker\n        v-model=\"date\"\n        type=\"date\"\n        start=\"2024-05-23\"\n        :end=\"today\"\n        @change=\"onDateChange\"\n        :clear-icon=\"false\"\n      />\n    </view>\n\n    <!-- 搜索输入框 -->\n    <view class=\"search-box\">\r\n\t  <view class=\"date-label\">搜索：</view>\n      <input\n        v-model=\"searchQuery\"\n        placeholder=\"搜索讲座或活动\"\n        class=\"search-input\"\n        @input=\"onSearchInput\"\n        @focus.stop\n        @click.stop\n      />\n    </view>\n\n    <!-- 搜索结果浮层 -->\n    <scroll-view\n      v-if=\"searchResults.length || loadingSearch || noMoreSearchResults\"\n      class=\"search-results\"\n      scroll-y\n      :style=\"{ maxHeight: '450rpx' }\"\n      @scrolltolower=\"loadMoreResults\"\n    >\n      <view\n        v-for=\"item in searchResults\"\n        :key=\"item.id\"\n        class=\"search-result-item\"\n        @click.stop=\"goToDetail(item)\"\n      >\n        {{ item.title || `ID: ${item.id}` }}\n      </view>\n      <view v-if=\"loadingSearch\" class=\"search-loading\">加载中...</view>\n      <view v-if=\"!loadingSearch && noMoreSearchResults && searchResults.length === 0\" class=\"search-empty\">无结果</view>\n    </scroll-view>\r\n\t\r\n\t<!-- 联系我们 -->\r\n<!-- \t<view class=\"second-bottom-bar\">\r\n\t  <text user-select>小报订阅QQ群：</text>\r\n\t  <text>{{qqgroup}}</text>\r\n\t</view>\r\n\t<view class=\"bottom-bar\">\r\n\t  <text user-select>联系我们：3504605396@qq.com</text>\r\n\t</view> -->\r\n\n  </view>\n</template>\n\n<script>\nimport { useUserStore } from '@/store/user';\nlet debounceTimer = null;\n\nexport default {\n  data() {\n    return {\n      today: this.getToday(),\n      date: this.getToday(),\n      searchQuery: '',\n      searchResults: [],\n      page: 1,\n      loadingSearch: false,\n      noMoreSearchResults: false,\r\n\t  qqgroup: 'loading...',\r\n\t  showContact: false, //控制弹窗显示\r\n\t  backupUrlFetcher:'https://nik-nul.github.io/keep/url.txt',\r\n\t  \n    };\n  },\r\n  mounted() {\r\n  \tthis.fetchQQgroup();\r\n  },\n  methods: {\n    onDateChange(val) {\n      this.date = val;\n      const prev = this.getYesterday(val);\n      this.fetchAndUpdateUserStore(prev);\n    },\n    fetchAndUpdateUserStore(date) {\n      const userStore = useUserStore();\n      const url = `http://52.184.65.42/typst/${date}`;\n      uni.request({\n        url,\n        method: 'GET',\n        success: (res) => {\n          userStore.setUserInfo(res.data);\n        },\n        fail: (err) => {\n          console.error('请求失败', err);\r\n\t\t  \r\n\t\t //  uni.request({\r\n\t\t //  \turl:backupUrlFetcher,\r\n\t\t\t// method:'GET',\r\n\t\t\t// success(backres) {\r\n\t\t\t// \tconst newBaseurl = backres.data.trim();\r\n\t\t\t// \tif(!newBaseurl){\r\n\t\t\t// \t\tconsole.error('备用地址为空');\r\n\t\t\t// \t\treturn;\r\n\t\t\t// \t}\r\n\t\t\t\t\r\n\t\t\t// \tconst newurl = `http://${newBaseurl}/typst/${date}`;\r\n\t\t\t// \tuni.request({\r\n\t\t\t// \t\turl:newurl,\r\n\t\t\t// \t\tmethod:'GET',\r\n\t\t\t// \t\tsuccess(res2) {\r\n\t\t\t// \t\t\tuserStore.setUserInfo(res2.data);\r\n\t\t\t// \t\t},\r\n\t\t\t// \t\tfail() {\r\n\t\t\t// \t\t\tconsole.error('备用服务器请求失败');\r\n\t\t\t// \t\t}\r\n\t\t\t// \t});\r\n\t\t\t// },\r\n\t\t\t// fail() {\r\n\t\t\t// \tconsole.error('备用地址请求失败');\r\n\t\t\t// }\r\n\t\t  // });\n        }\n      });\n    },\n    getToday() {\n      const d = new Date();\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n    },\n    getYesterday(dateStr) {\n      const date = new Date(dateStr);\n      date.setDate(date.getDate() - 1);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n    },\n\n    // 搜索功能\n    onSearchInput() {\n      clearTimeout(debounceTimer);\n      debounceTimer = setTimeout(() => {\n        this.page = 1;\n        this.searchResults = [];\n        this.noMoreSearchResults = false;\n        this.searchLecture(this.searchQuery);\n      }, 400);\n    },\n    searchLecture(keyword) {\n      if (!keyword) {\n        this.searchResults = [];\n        return;\n      }\n      this.loadingSearch = true;\n      uni.request({\r\n        url: `http://52.184.65.42/api/search?q=${encodeURIComponent(keyword)}&page=${this.page}`,\r\n        method: 'GET',\r\n        success: async (res) => {\r\n          const ids = (res.data || []).map(arr => arr[0]);\r\n          if (ids.length === 0) {\r\n            this.noMoreSearchResults = true;\r\n          }\r\n      \r\n          const results = [];\r\n          for (const id of ids) {\r\n            const title = await this.fetchTitleById(id);\r\n            results.push({ id, title });\r\n          }\r\n      \r\n          this.searchResults = [...this.searchResults, ...results];\r\n        },\r\n        fail: () => {\r\n          uni.showToast({ title: '搜索失败', icon: 'none' });\r\n        },\r\n     //      // 请求备用地址\r\n     //      uni.request({\r\n     //        url:backupUrlFetcher,\r\n     //        method: 'GET',\r\n     //        success: (backres) => {\r\n     //          const newBackurl = backres.data.trim();\r\n\t\t\t  // if(!newBackurl){\r\n\t\t\t\t //  console.error('备用地址为空');\r\n\t\t\t\t //  return;\r\n\t\t\t  // }\r\n     //          const newurl = `http://${backupBase}/api/search?q=${encodeURIComponent(keyword)}&page=${this.page}`;\r\n      \r\n     //          // 发起备用请求\r\n     //          uni.request({\r\n     //            url: newurl,\r\n     //            method: 'GET',\r\n     //            success: async (res2) => {\r\n     //              const ids = (res2.data || []).map(arr => arr[0]);\r\n     //              if (ids.length === 0) {\r\n     //                this.noMoreSearchResults = true;\r\n     //              }\r\n      \r\n     //              const results = [];\r\n     //              for (const id of ids) {\r\n     //                const title = await this.fetchTitleById(id);\r\n     //                results.push({ id, title });\r\n     //              }\r\n      \r\n     //              this.searchResults = [...this.searchResults, ...results];\r\n     //            },\r\n     //            fail: () => {\r\n     //              uni.showToast({ title: '备用地址请求失败', icon: 'none' });\r\n     //            },\r\n     //            complete: () => {\r\n     //              this.loadingSearch = false;\r\n     //            }\r\n     //          });\r\n     //        },\r\n     //        fail: () => {\r\n     //          uni.showToast({ title: '获取备用地址失败', icon: 'none' });\r\n     //          this.loadingSearch = false;\r\n     //        }\r\n     //      });\r\n        // },\r\n        complete: () => {\r\n            this.loadingSearch = false;\r\n        }\r\n      });\n    },\n    fetchTitleById(id) {\n      const cacheKey = `search_title_${id}`;\n      let title = uni.getStorageSync(cacheKey);\n      if (title) return Promise.resolve(title);\n\n      return new Promise(resolve => {\n        uni.request({\n          url: `http://52.184.65.42/api/query?id=${id}`,\n          method: 'GET',\n          success: (res) => {\n            if (res.statusCode === 200 && Array.isArray(res.data) && res.data.length > 0) {\n              title = res.data[0][3];\n              uni.setStorageSync(cacheKey, title);\n              resolve(title);\n            } else {\n              resolve('');\n            }\n          },\n          fail: () => {\r\n\t\t\t //  uni.request({\r\n\t\t\t //  \turl:backupUrlFetcher,\r\n\t\t\t\t// method:'GET',\r\n\t\t\t\t// success(backres) {\r\n\t\t\t\t// \tconst newBaseurl = backres.data.trim();\r\n\t\t\t\t// \tif(!newBaseurl){\r\n\t\t\t\t// \t\tconsole.error('备用地址为空');\r\n\t\t\t\t// \t\treturn;\r\n\t\t\t\t// \t}\r\n\t\t\t\t// \tconst newurl = `http://${newBaseurl}/api/query?id=${id}`;\r\n\t\t\t\t// \tuni.request({\r\n\t\t\t\t// \t\turl:newurl,\r\n\t\t\t\t// \t\tmethod:'GET',\r\n\t\t\t\t// \t\tsuccess(res2) {\r\n\t\t\t\t// \t\t\tif (res2.statusCode === 200 && Array.isArray(res2.data) && res2.data.length > 0) {\r\n\t\t\t\t// \t\t\t  title = res2.data[0][3];\r\n\t\t\t\t// \t\t\t  uni.setStorageSync(cacheKey, title);\r\n\t\t\t\t// \t\t\t  resolve(title);\r\n\t\t\t\t// \t\t\t} else {\r\n\t\t\t\t// \t\t\t  resolve('');\r\n\t\t\t\t// \t\t\t}\r\n\t\t\t\t// \t\t},\r\n\t\t\t\t// \t\tfail() {\r\n\t\t\t\t// \t\t\tconsole.error('备用服务器请求失败');\r\n\t\t\t\t// \t\t}\r\n\t\t\t\t// \t});\r\n\t\t\t\t// },\r\n\t\t\t\t// fail() {\r\n\t\t\t\t// \tconsole.error('备用地址请求失败');\r\n\t\t\t\t// }\r\n\t\t\t  // });\r\n\t\t  }\n        });\n      });\n    },\n    loadMoreResults() {\r\n\t  // console.log(\"触底触发，准备加载 page:\", this.page + 1);\n      if (this.loadingSearch || this.noMoreSearchResults){\r\n\t\t// console.log('不再加载');\r\n\t\treturn;  \r\n\t  }\n      this.page += 1;\r\n\t  // console.log(\"加载第\", this.page, \"页\"); // 检查是否执行\n      this.searchLecture(this.searchQuery);\n    },\n    goToDetail(item) {\n      this.searchResults = [];\n      this.searchQuery = '';\n      uni.navigateTo({\n        url: `/pages/tabbar/lecture/lectureDetail?id=${item.id}`\n      });\n    },\n    hideSearchOverlay() {\n      this.searchResults = [];\n    },\r\n\tfetchQQgroup(){\r\n\t  uni.request({\r\n\t  \turl:`https://nik-nul.github.io/keep/qqg.txt`,\r\n\t\tmethod:'GET',\r\n\t\tsuccess:(res) => {\r\n\t\t\tthis.qqgroup = res.data;\r\n\t\t},\r\n\t\tfail:(err) => {\r\n\t\t\tconsole.error('请求失败', err);\r\n\t\t\tthis.qqgroup = '获取失败';\r\n\t\t}\r\n\t  })\r\n\t}\n  }\n};\n</script>\n<style>\n.container {\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  justify-content: flex-start;\n  height: 100vh;\n  box-sizing: border-box;\n}\n.date-picker-box {\n  width: 100%;\n  padding: 10px 0;\n  border-top: 1px solid #ccc;\n  border-bottom: 1px solid #ccc;\n  box-sizing: border-box;\n}\n.date-label {\n  font-size: 14px;\n  font-weight: normal;\n  margin: 0 0px 10px 10px;\n}\n.search-box {\n  margin-top: 10px;\n}\n.search-input {\n  left: 2.5%;\n  width: 93%;\n  height: 36px;\n  padding: 0 12px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  font-size: 14px;\n}\n\n.search-results {\n  position: static;\n  top: 200px;\n  left: 2.5%;\n  right: 2.5%;\n  width: 100%;\n  height: calc(100vh - 200px);\n  background-color: #fff;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n  overflow-y: scroll;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  z-index: 999;\r\n  padding-bottom: 40px;\n}\n.search-result-item {\n  padding: 16px 20px;\n  font-size: 16px;\n  border-bottom: 1px solid #eee;\n}\n.search-result-item:last-child {\n  border-bottom: none;\n}\n.search-loading, .search-empty {\n  text-align: center;\n  font-size: 12px;\n  color: #999;\n  padding: 10px 0;\n}\n.contact-trigger {\n  font-size: 14px;\n  padding: 10px;\n  text-align: left;\n}\n\n.contact-popup {\n  position: fixed;\n  top: 30%;\n  left: 10%;\n  right: 10%;\n  background: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n  padding: 20px;\n  z-index: 1000;\n}\n\n.popup-content text {\n  display: block;\n  margin-bottom: 10px;\n  font-size: 14px;\n  color: #333;\n}\n\n.popup-close {\n  margin-top: 10px;\n  text-align: right;\n  color: #999;\n  font-size: 12px;\n}\n\n\n</style>\n","import MiniProgramPage from 'D:/NJU/code/NJUnews/code/njunews/pages/tabbar/other/other.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","uni"],"mappings":"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"}