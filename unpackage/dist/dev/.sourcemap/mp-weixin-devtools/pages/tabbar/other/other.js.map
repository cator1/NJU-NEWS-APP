{"version":3,"names":["debounceTimer","_sfc_main","data","today","getToday","date","searchQuery","searchResults","page","loadingSearch","noMoreSearchResults","methods","onDateChange","val","prev","getYesterday","fetchAndUpdateUserStore","userStore","store_user","useUserStore","url","concat","common_vendor","index","request","method","success","res","setUserInfo","fail","err2","__f__","d","Date","getFullYear","String","getMonth","padStart","getDate","dateStr","setDate","onSearchInput","_this","clearTimeout","setTimeout","searchLecture","keyword","_this2","encodeURIComponent","_success","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","ids","results","_iterator","_step","id","title","wrap","_callee$","_context","next","map","arr","length","_createForOfIteratorHelper2","s","n","done","value","fetchTitleById","sent","push","t0","e","f","finish","_toConsumableArray2","stop","_x","apply","arguments","showToast","icon","complete","cacheKey","getStorageSync","Promise","resolve","statusCode","Array","isArray","setStorageSync","loadMoreResults","goToDetail","item","navigateTo","hideSearchOverlay","onLoad","qqgroup","err","wx","createPage","MiniProgramPage"],"sources":["other.vue","cGFnZXMvdGFiYmFyL290aGVyL290aGVyLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\" @click=\"hideSearchOverlay\">\n    <!-- 日期选择 -->\n    <view class=\"date-picker-box\">\n      <view class=\"date-label\">日期选择：</view>\n      <uni-datetime-picker\n        v-model=\"date\"\n        type=\"date\"\n        start=\"2024-05-23\"\n        :end=\"today\"\n        @change=\"onDateChange\"\n        :clear-icon=\"false\"\n      />\n    </view>\n\n    <!-- 搜索输入框 -->\n    <view class=\"search-box\">\r\n\t  <view class=\"date-label\">搜索：</view>\n      <input\n        v-model=\"searchQuery\"\n        placeholder=\"搜索讲座或活动\"\n        class=\"search-input\"\n        @input=\"onSearchInput\"\n        @focus.stop\n        @click.stop\n      />\n    </view>\n\n    <!-- 搜索结果浮层 -->\n    <scroll-view\n      v-if=\"searchResults.length || loadingSearch || noMoreSearchResults\"\n      class=\"search-results\"\n      scroll-y\n      :style=\"{ maxHeight: '450rpx' }\"\n      @scrolltolower=\"loadMoreResults\"\n    >\n      <view\n        v-for=\"item in searchResults\"\n        :key=\"item.id\"\n        class=\"search-result-item\"\n        @click.stop=\"goToDetail(item)\"\n      >\n        {{ item.title || `ID: ${item.id}` }}\n      </view>\n      <view v-if=\"loadingSearch\" class=\"search-loading\">加载中...</view>\n      <view v-if=\"!loadingSearch && noMoreSearchResults && searchResults.length === 0\" class=\"search-empty\">无结果</view>\n    </scroll-view>\r\n\t\r\n\t<!-- 联系我们 -->\r\n\t<view class=\"second-bottom-bar\">\r\n\t  <text user-select>小报订阅QQ群：{{qqgroup}}</text>\r\n\t</view>\r\n\t<view class=\"bottom-bar\">\r\n\t  <text user-select>联系我们：3504605396@qq.com</text>\r\n\t</view>\r\n\n  </view>\n</template>\n\n<script>\nimport { useUserStore } from '@/store/user';\nlet debounceTimer = null;\n\nexport default {\n  data() {\n    return {\n      today: this.getToday(),\n      date: this.getToday(),\n      searchQuery: '',\n      searchResults: [],\n      page: 1,\n      loadingSearch: false,\n      noMoreSearchResults: false,\n    };\n  },\n  methods: {\n    onDateChange(val) {\n      this.date = val;\n      const prev = this.getYesterday(val);\n      this.fetchAndUpdateUserStore(prev);\n    },\n    fetchAndUpdateUserStore(date) {\n      const userStore = useUserStore();\n      const url = `http://52.184.65.42/typst/${date}`;\n      uni.request({\n        url,\n        method: 'GET',\n        success: (res) => {\n          userStore.setUserInfo(res.data);\n        },\n        fail: (err) => {\n          console.error('请求失败:', err);\n        }\n      });\n    },\n    getToday() {\n      const d = new Date();\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n    },\n    getYesterday(dateStr) {\n      const date = new Date(dateStr);\n      date.setDate(date.getDate() - 1);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n    },\n\n    // 搜索功能\n    onSearchInput() {\n      clearTimeout(debounceTimer);\n      debounceTimer = setTimeout(() => {\n        this.page = 1;\n        this.searchResults = [];\n        this.noMoreSearchResults = false;\n        this.searchLecture(this.searchQuery);\n      }, 400);\n    },\n    searchLecture(keyword) {\n      if (!keyword) {\n        this.searchResults = [];\n        return;\n      }\n      this.loadingSearch = true;\n      uni.request({\n        url: `http://52.184.65.42/api/search?q=${encodeURIComponent(keyword)}&page=${this.page}`,\n        method: 'GET',\n        success: async (res) => {\n          const ids = (res.data || []).map(arr => arr[0]);\n          if (ids.length === 0) {\n            this.noMoreSearchResults = true;\n          }\n\n          const results = [];\n          for (const id of ids) {\n            const title = await this.fetchTitleById(id);\n            results.push({ id, title });\n          }\n\n          this.searchResults = [...this.searchResults, ...results];\n        },\n        fail: () => {\n          uni.showToast({ title: '搜索失败', icon: 'none' });\n        },\n        complete: () => {\n          this.loadingSearch = false;\n        }\n      });\n    },\n    fetchTitleById(id) {\n      const cacheKey = `search_title_${id}`;\n      let title = uni.getStorageSync(cacheKey);\n      if (title) return Promise.resolve(title);\n\n      return new Promise(resolve => {\n        uni.request({\n          url: `http://52.184.65.42/api/query?id=${id}`,\n          method: 'GET',\n          success: (res) => {\n            if (res.statusCode === 200 && Array.isArray(res.data) && res.data.length > 0) {\n              title = res.data[0][3];\n              uni.setStorageSync(cacheKey, title);\n              resolve(title);\n            } else {\n              resolve('');\n            }\n          },\n          fail: () => resolve('')\n        });\n      });\n    },\n    loadMoreResults() {\n      if (this.loadingSearch || this.noMoreSearchResults) return;\n      this.page += 1;\n      this.searchLecture(this.searchQuery);\n    },\n    goToDetail(item) {\n      this.searchResults = [];\n      this.searchQuery = '';\n      uni.navigateTo({\n        url: `/pages/tabbar/lecture/lectureDetail?id=${item.id}`\n      });\n    },\n    hideSearchOverlay() {\n      this.searchResults = [];\n    }\n  },\r\n  onLoad() {\r\n  \tuni.request({\r\n  \t\turl:qqgroup,\r\n\t\tmethod:'GET',\r\n\t\tfail() {\r\n\t\t\tconsole.error('请求失败', err);\r\n\t\t}\r\n  \t})\r\n  }\n};\n</script>\n<style>\n.container {\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  justify-content: flex-start;\n  height: 100vh;\n  box-sizing: border-box;\n}\n.date-picker-box {\n  width: 100%;\n  padding: 10px 0;\n  border-top: 1px solid #ccc;\n  border-bottom: 1px solid #ccc;\n  box-sizing: border-box;\n}\n.date-label {\n  font-size: 14px;\n  font-weight: normal;\n  margin: 0 0px 10px 10px;\n}\n.search-box {\n  margin-top: 10px;\n}\n.search-input {\n  left: 2.5%;\n  width: 93%;\n  height: 36px;\n  padding: 0 12px;\n  border: 1px solid #ccc;\n  border-radius: 8px;\n  font-size: 14px;\n}\n\n.search-results {\n  position: fixed;\n  top: 165px;\n  left: 2.5%;\n  right: 2.5%;\n  width: 95%;\n  height: calc(100vh - 200px); /* 留出顶部/底部空隙 */\n  background-color: #fff;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n  overflow-y: scroll;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n  z-index: 999;\n}\n.search-result-item {\n  padding: 16px 20px;\n  font-size: 16px;\n  border-bottom: 1px solid #eee;\n}\n.search-result-item:last-child {\n  border-bottom: none;\n}\n.search-loading, .search-empty {\n  text-align: center;\n  font-size: 12px;\n  color: #999;\n  padding: 10px 0;\n}\n\n.bottom-bar {\n  position: fixed;\n  bottom: 0px;\n  left: 0;\n  right: 0;\n  padding: 10px 0;\n  text-align: center;\n  font-size: 14px;\n  color: #333;\n  z-index: 998;\n}\n.second-bottom-bar {\n  position: fixed;\n  bottom: 20px;\n  left: 0;\n  right: 0;\n  padding: 10px 0;\n  text-align: center;\n  font-size: 14px;\n  color: #333;\n  z-index: 998;\n}\n</style>\n","import MiniProgramPage from 'D:/NJU/code/NJUnews/code/njunews/pages/tabbar/other/other.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}